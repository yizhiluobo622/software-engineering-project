import{d as M,r as w,o as D,c as E,a,w as m,k as L,v as B,t as H,n as P,f as T}from"./index-89733f59.js";import{d as e}from"./db-8a84ae2f.js";import{c as S}from"./courses-4127035d.js";import{c as U}from"./resources-4bde5add.js";import{c as F}from"./notes-45306c61.js";import{c as h}from"./tasks-02814935.js";import"./id-0d1586fb.js";const $={class:"col"},q={class:"panel col"},z={class:"row"},G={class:"panel col"},K={class:"row"},Q={class:"row"},W={class:"panel col"},X={class:"row"},Y={class:"muted"},Z={class:"row"},nt=M({__name:"Settings",setup(_){async function I(){const o={courses:await e.courses.toArray(),modules:await e.modules.toArray(),resources:await e.resources.toArray(),resBlobs:await(async()=>{const r=await e.resBlobs.toArray(),i=[];for(const u of r){const b=await V(u.blob);i.push({id:u.id,base64:b,type:u.blob.type})}return i})(),notes:await e.notes.toArray(),tasks:await e.tasks.toArray(),tags:await e.tags.toArray()},t=new Blob([JSON.stringify(o,null,2)],{type:"application/json"}),s=URL.createObjectURL(t),l=document.createElement("a");l.href=s,l.download="smart-study-backup.json",l.click(),URL.revokeObjectURL(s)}async function O(o){var i;const t=o.target,s=(i=t.files)==null?void 0:i[0];if(!s)return;const l=await s.text(),r=JSON.parse(l);await e.transaction("rw",e.courses,e.modules,e.resources,e.notes,e.tasks,e.tags,e.resBlobs,async()=>{if(await e.courses.clear(),await e.modules.clear(),await e.resources.clear(),await e.notes.clear(),await e.tasks.clear(),await e.tags.clear(),await e.resBlobs.clear(),await e.courses.bulkAdd(r.courses||[]),await e.modules.bulkAdd(r.modules||[]),await e.resources.bulkAdd(r.resources||[]),Array.isArray(r.resBlobs))for(const u of r.resBlobs){const b=atob(u.base64),x=new Uint8Array(b.length);for(let y=0;y<b.length;y++)x[y]=b.charCodeAt(y);const J=new Blob([x],{type:u.type||"application/octet-stream"});await e.resBlobs.put({id:u.id,blob:J})}await e.notes.bulkAdd(r.notes||[]),await e.tasks.bulkAdd(r.tasks||[]),await e.tags.bulkAdd(r.tags||[])}),t&&(t.value=""),alert("导入完成")}async function N(){const o=await S("软件工程","2025春",["必修"]),t=await S("数据库系统原理","2025春",["必修"]);await U({courseId:o.id,type:"text",title:"课程大纲",authors:["教师A"]}),await U({courseId:t.id,type:"text",title:"关系模型概述"}),await F({courseId:o.id,title:"第一次课堂笔记",contentMd:"# 需求工程\\n- 用例\\n- DFD"}),await h({title:"完成实验一",courseId:o.id}),await h({title:"阅读教材第3章",courseId:t.id}),alert("示例数据已装载")}async function R(){await e.transaction("rw",e.courses,e.modules,e.resources,e.notes,e.tasks,e.tags,e.resBlobs,async()=>{await e.courses.clear(),await e.modules.clear(),await e.resources.clear(),await e.notes.clear(),await e.tasks.clear(),await e.tags.clear(),await e.resBlobs.clear()}),alert("已清空所有数据")}function V(o){return new Promise((t,s)=>{try{const l=new FileReader;l.onloadend=()=>{const i=l.result.split(",")[1]||"";t(i)},l.onerror=r=>s(r),l.readAsDataURL(o)}catch(l){s(l)}})}const c=w("light"),d=w("#ffffff"),p=w("#2563eb"),n=w(360),f=w(!0);function v(){const o={theme:c.value,bgColor:d.value,primaryColor:p.value,previewHeight:n.value,mdBreaks:f.value};localStorage.setItem("ssm-ui",JSON.stringify(o))}function g(){c.value==="dark"?A({"--bg":"#0f172a","--panel":"#111827","--text":"#e5e7eb","--muted":"#9ca3af","--border":"#1f2937","--surface":"#0b1220"}):A({"--bg":"#ffffff","--panel":"#ffffff","--text":"#111827","--muted":"#6b7280","--border":"#e5e7eb","--surface":"#f9fafb"}),k(),C(),v()}function k(){A({"--primary":p.value,"--bg":d.value}),v()}function C(){document.documentElement.style.setProperty("--preview-height",`${n.value}px`),v()}function j(){c.value="light",d.value="#ffffff",p.value="#2563eb",n.value=360,f.value=!0,g()}function A(o){const t=document.documentElement;Object.entries(o).forEach(([s,l])=>t.style.setProperty(s,l))}return D(()=>{try{const o=localStorage.getItem("ssm-ui");if(o){const t=JSON.parse(o);c.value=t.theme??"light",d.value=t.bgColor??"#ffffff",p.value=t.primaryColor??"#2563eb",n.value=t.previewHeight??360,f.value=t.mdBreaks??!0}}catch{}g()}),(o,t)=>(T(),E("div",$,[t[16]||(t[16]=a("div",{class:"row"},[a("div",{class:"h1"},"设置"),a("span",{class:"muted"},"数据与外观设置")],-1)),a("div",q,[a("div",z,[a("button",{onClick:I},"导出 JSON"),a("input",{type:"file",accept:"application/json,.json",onChange:O},null,32)]),t[5]||(t[5]=a("div",{class:"muted"},"导出包含课程、模块、资源、笔记、任务、标签所有数据。导入时请选择 JSON 文件以恢复用户数据。",-1))]),a("div",{class:"panel col"},[t[6]||(t[6]=a("div",{class:"h3"},"用户数据导入与导出",-1)),a("div",{class:"row"},[a("button",{onClick:N},"装载示例数据"),a("button",{class:"danger",onClick:R},"清空全部数据")])]),a("div",G,[t[11]||(t[11]=a("div",{class:"h3"},"外观设置",-1)),a("div",K,[t[8]||(t[8]=a("label",null,"主题",-1)),m(a("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>c.value=s),onChange:g},[...t[7]||(t[7]=[a("option",{value:"light"},"浅色",-1),a("option",{value:"dark"},"深色",-1)])],544),[[L,c.value]])]),a("div",Q,[t[9]||(t[9]=a("label",null,"背景色",-1)),m(a("input",{type:"color","onUpdate:modelValue":t[1]||(t[1]=s=>d.value=s),onInput:k},null,544),[[B,d.value]]),t[10]||(t[10]=a("label",null,"主色",-1)),m(a("input",{type:"color","onUpdate:modelValue":t[2]||(t[2]=s=>p.value=s),onInput:k},null,544),[[B,p.value]])]),a("div",{class:"row"},[a("button",{onClick:j},"恢复外观默认")]),t[12]||(t[12]=a("div",{class:"muted"},"外观设置仅影响本机浏览器（保存在 localStorage）。",-1))]),a("div",W,[t[15]||(t[15]=a("div",{class:"h3"},"编辑与预览",-1)),a("div",X,[t[13]||(t[13]=a("label",null,"预览高度",-1)),m(a("input",{type:"range",min:"240",max:"640",step:"20","onUpdate:modelValue":t[3]||(t[3]=s=>n.value=s),onInput:C},null,544),[[B,n.value,void 0,{number:!0}]]),a("span",Y,H(n.value)+"px",1)]),a("div",Z,[t[14]||(t[14]=a("label",null,"Markdown 普通回车换行",-1)),m(a("input",{type:"checkbox","onUpdate:modelValue":t[4]||(t[4]=s=>f.value=s),onChange:v},null,544),[[P,f.value]])])])]))}});export{nt as default};
