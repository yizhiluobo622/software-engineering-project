import{d as t}from"./db-a38e221e.js";import{c as w}from"./courses-04590859.js";import{c as b}from"./resources-11eed945.js";import{c as g}from"./notes-58d3eb05.js";import{c as p}from"./tasks-0c9943e9.js";import{d as B,c as v,a as s,f as C}from"./index-986e3362.js";import"./id-0d1586fb.js";const h={class:"col"},_={class:"panel col"},x={class:"row"},J=B({__name:"Settings",setup(S){async function m(){const o={courses:await t.courses.toArray(),modules:await t.modules.toArray(),resources:await t.resources.toArray(),resBlobs:await(async()=>{const e=await t.resBlobs.toArray(),n=[];for(const r of e){const l=await r.blob.arrayBuffer(),u=btoa(String.fromCharCode(...new Uint8Array(l)));n.push({id:r.id,base64:u,type:r.blob.type})}return n})(),notes:await t.notes.toArray(),tasks:await t.tasks.toArray(),tags:await t.tags.toArray()},a=new Blob([JSON.stringify(o,null,2)],{type:"application/json"}),c=URL.createObjectURL(a),i=document.createElement("a");i.href=c,i.download="smart-study-backup.json",i.click(),URL.revokeObjectURL(c)}async function f(o){var n;const a=o.target,c=(n=a.files)==null?void 0:n[0];if(!c)return;const i=await c.text(),e=JSON.parse(i);await t.transaction("rw",t.courses,t.modules,t.resources,t.notes,t.tasks,t.tags,t.resBlobs,async()=>{if(await t.courses.clear(),await t.modules.clear(),await t.resources.clear(),await t.notes.clear(),await t.tasks.clear(),await t.tags.clear(),await t.resBlobs.clear(),await t.courses.bulkAdd(e.courses||[]),await t.modules.bulkAdd(e.modules||[]),await t.resources.bulkAdd(e.resources||[]),Array.isArray(e.resBlobs))for(const r of e.resBlobs){const l=atob(r.base64),u=new Uint8Array(l.length);for(let d=0;d<l.length;d++)u[d]=l.charCodeAt(d);const A=new Blob([u],{type:r.type||"application/octet-stream"});await t.resBlobs.put({id:r.id,blob:A})}await t.notes.bulkAdd(e.notes||[]),await t.tasks.bulkAdd(e.tasks||[]),await t.tags.bulkAdd(e.tags||[])}),a&&(a.value=""),alert("导入完成")}async function y(){const o=await w("软件工程","2025春",["必修"]),a=await w("数据库系统原理","2025春",["必修"]);await b({courseId:o.id,type:"text",title:"课程大纲",authors:["教师A"]}),await b({courseId:a.id,type:"text",title:"关系模型概述"}),await g({courseId:o.id,title:"第一次课堂笔记",contentMd:"# 需求工程\\n- 用例\\n- DFD"}),await p({title:"完成实验一",courseId:o.id}),await p({title:"阅读教材第3章",courseId:a.id}),alert("示例数据已装载")}async function k(){await t.transaction("rw",t.courses,t.modules,t.resources,t.notes,t.tasks,t.tags,t.resBlobs,async()=>{await t.courses.clear(),await t.modules.clear(),await t.resources.clear(),await t.notes.clear(),await t.tasks.clear(),await t.tags.clear(),await t.resBlobs.clear()}),alert("已清空所有数据")}return(o,a)=>(C(),v("div",h,[a[2]||(a[2]=s("div",{class:"row"},[s("div",{class:"h1"},"设置"),s("span",{class:"muted"},"数据导入 / 导出")],-1)),s("div",_,[s("div",x,[s("button",{onClick:m},"导出 JSON"),s("input",{type:"file",onChange:f},null,32)]),a[0]||(a[0]=s("div",{class:"muted"},"导出包含课程、模块、资源、笔记、任务、标签所有数据。",-1))]),s("div",{class:"panel col"},[a[1]||(a[1]=s("div",{class:"h3"},"示例数据",-1)),s("div",{class:"row"},[s("button",{onClick:y},"装载示例数据"),s("button",{class:"danger",onClick:k},"清空全部数据")])])]))}});export{J as default};
